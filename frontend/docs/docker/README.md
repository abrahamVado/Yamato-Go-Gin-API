# Yamato Docker Images

The repository now includes production-ready Dockerfiles for the full workspace and the web
application. Use the steps below to build and run them locally with Docker.

## Root workspace image

The top-level `Dockerfile` builds the entire project, runs `npm run build`, and serves the compiled
Next.js application via the npm `start` script.

1. Build the image:
   ```bash
   docker build -t yamato-app .
   ```
2. Run the container and expose port 3000:
   ```bash
   docker run --rm -p 3000:3000 yamato-app
   ```
3. Visit `http://localhost:3000` in your browser once the container prints "ready".

If your backend API does not run on the default `http://localhost:8080`, define the environment
variables documented in `web/src/lib/backend.ts` (for example
`NEXT_PUBLIC_UPLOAD_BACKEND="https://api.example.com"`) when starting the container. Pair the
container with the Nginx edge so browser calls use the single-origin `http://localhost:3000/api`
base URL:
```bash
docker run --rm -p 3000:3000 -e NEXT_PUBLIC_UPLOAD_BACKEND="https://api.example.com" \
  -e NEXT_PUBLIC_API_BASE_URL="http://localhost:3000/api" yamato-app
```

## Web-only image

The `web/Dockerfile` focuses on the Next.js application without the root automation. Build it when
you want a smaller context scoped only to `/web`:

1. Change into the `web/` directory and build the image:
   ```bash
   cd web
   docker build -t yamato-web .
   ```
2. Run the container on port 3000:
   ```bash
   docker run --rm -p 3000:3000 yamato-web
   ```

Both images rely on production builds generated by `next build`. Always keep your backend health
check reachable at `http://localhost:8080/api/health` or adjust the environment overrides so the
frontend can complete authenticated requests.
