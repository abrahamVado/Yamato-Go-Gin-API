upstream next_upstream { server nextjs:3000; }
upstream laravel_upstream { server phpapi:80; }  # phpapi = backend nginx service name

server {
  listen 80;
  server_name _;

  location / { proxy_pass http://next_upstream; proxy_set_header Host $host; }

  location ~ ^/api(/|$) {
    rewrite ^/api/?(.*)$ /$1 break;    # optional: strip /api
    proxy_pass http://laravel_upstream;
    proxy_set_header Host $host;
  }
}
